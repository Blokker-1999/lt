<section><title>Hard disk devices</title>
	<section><title>Terminology</title>
		<para>Data is commonly stored on magnetic or optical <command>disk platters</command><indexterm><primary>disk platters</primary></indexterm>. The platters are rotated (at high speeds). Data is read by <command>heads</command><indexterm><primary>head (hard disk device)</primary></indexterm>, which are very close to the surface of the platter, without touching it! The heads are mounted on an arm (sometimes called a comb).</para>
		<para>Data is written in concentric circles or <command>tracks</command><indexterm><primary>track</primary></indexterm>. Track zero is (usually ?) on the inside. The time it takes to position the head over a certain track is called the <command>seek time</command><indexterm><primary>seek time</primary></indexterm>. Often the platters are stacked on top of each other, hence the set of tracks accessible at a certain position of the comb forms a <command>cylinder</command><indexterm><primary>cylinder</primary></indexterm>. Tracks are divided into 512 byte <command>sectors</command><indexterm><primary>sector</primary></indexterm>, with more unused space (<command>gap</command>) between the sectors on the outside of the platter. </para>
		<para>When you break down the advertised <command>access time</command><indexterm><primary>access time</primary></indexterm> of a hard drive, you will notice that most of that time is taken by movement of the heads (about 65%) and <command>rotational latency</command><indexterm><primary>rotational latency</primary></indexterm> (about 30%). </para>
		<para>Random access hard disk devices have an abstraction layer called <command>block device</command><indexterm><primary>block device</primary></indexterm> to enable formatting in fixed-size (usually 512 bytes) blocks. Blocks can be accessed independent of access to other blocks. You can recognize a block device by the letter b as first character of ls -l.</para>
		<screen>
[root@RHEL4b ~]# ls -l /dev/sda*
brw-rw----  1 root disk 8, 0 Aug  4 22:55 /dev/sda
brw-rw----  1 root disk 8, 1 Aug  4 22:55 /dev/sda1
brw-rw----  1 root disk 8, 2 Aug  4 22:55 /dev/sda2
[root@RHEL4b ~]#
		</screen>
	</section>	
	<section><title>IDE or SCSI</title>
		<para>Actually, the title should be <command>ATA</command><indexterm><primary>ATA</primary></indexterm> or <command>SCSI</command><indexterm><primary>SCSI</primary></indexterm>, since IDE is an ATA-compatible device. Most desktops use ATA devices. ATA allows two devices per bus, one <command>master</command><indexterm><primary>master (hard disk device)</primary></indexterm> and one <command>slave</command><indexterm><primary>slave (hard disk device)</primary></indexterm>. Unless your controller and devices support <command>cable select</command><indexterm><primary>cable select</primary></indexterm>, you have to set this manually with jumpers. With the introduction of <command>SATA</command><indexterm><primary>SATA</primary></indexterm> (Serial ATA), the original ATA was renamed to <command>Parallel ATA</command><indexterm><primary>Parallel ATA</primary></indexterm>. Optical drives often use <command>atapi</command><indexterm><primary>atapi</primary></indexterm>, which is an ATA interface using the SCSI communication protocol.</para>
		<para>When using the <command>Small Computer System Interface</command>, each device gets a unique <command>SCSI ID</command><indexterm><primary>SCSI ID</primary></indexterm>. The SCSI controller also needs a SCSI ID, do not use this ID for a SCSI-attached device. Older 8-bit SCSI is now called <command>narrow</command>, whereas 16-bit is <command>wide</command>. When the bus speeds was doubled to 10Mhz, this was known as <command>fast SCSI</command>. Doubling to 20Mhz made it <command>ultra SCSI</command>. Take a look at http://en.wikipedia.org/wiki/SCSI for more SCSI-standards. </para>
	</section>
	<section><title>Device Naming</title>
		<para>All ATA drives on your system will start with <command>/dev/hd</command><indexterm><primary>/dev/hdX</primary></indexterm> followed by a unit letter. The master hdd on the first ATA controller is /dev/hda, the slave is /dev/hdb. For the second controller, the names of the devices are /dev/hdc and /dev/hdd.</para>
		
<table frame='all'><title>IDE device naming</title>
<?dbfo table-width="70%" ?>
<tgroup cols='3' align='left' colsep='1' rowsep='1'>
<colspec colname='controller' align="center"/>
<colspec colname='connection' align="center"/>
<colspec colname='device name' align="center"/>
<thead>
<row>
  <entry>Controller</entry>
  <entry>Connection</entry>
  <entry>Device Name</entry>
</row>
</thead>
<tbody>
<row>
  <entry morerows='1' valign='middle'>IDE0</entry>
  <entry>master</entry>
  <entry>/dev/hda</entry>
</row>
<row>
  <entry>slave</entry>
  <entry>/dev/hdb</entry>
</row>
<row>
  <entry morerows='1' valign='middle'>IDE1</entry>
  <entry>master</entry>
  <entry>/dev/hdc</entry>
</row>
<row>
  <entry>slave</entry>
  <entry>/dev/hdd</entry>
</row>
</tbody>
</tgroup>
</table>

		<para>SCSI drives follow a similar scheme, but all start with <command>/dev/sd</command><indexterm><primary>/dev/sdX</primary></indexterm>. When you run out of letters (after /dev/sdz), you can continue with /dev/sdaa and /dev/sdab and so on. (We will see later on that LVM volumes are commonly seen as /dev/md0, /dev/md1 etc)</para>
		<para>Below a <command>sample</command> of how SCSI devices on a linux can be named. Adding a SCSI disk or RAID controller with a lower SCSI address will change the naming scheme (shifting the higher SCSI addresses one letter further in the alphabet).</para>
<table frame='all'><title>SCSI device naming</title>
<?dbfo table-width="80%" ?>
<tgroup cols='3' align='left' colsep='1' rowsep='1'>
<colspec colname='device' colwidth="2.5*" align="center"/>
<colspec colname='SCSI address' colwidth="1.5*" align="center"/>
<colspec colname='linux device name' colwidth="2*" align="center"/>
<thead>
<row>
  <entry>Device</entry>
  <entry>SCSI ID</entry>
  <entry>Device Name</entry>
</row>
</thead>

<tbody>
<row>
  <entry>Disk 0</entry>
  <entry>0</entry>
  <entry>/dev/sda</entry>
</row>
<row>
  <entry>Disk 1</entry>
  <entry>1</entry>
  <entry>/dev/sdb</entry>
</row>
<row>
  <entry>RAID Controller 0</entry>
  <entry>5</entry>
  <entry>/dev/sdc</entry>
</row>
<row>
  <entry>RAID Controller 1</entry>
  <entry>6</entry>
  <entry>/dev/sdd</entry>
</row>
</tbody>
</tgroup>
</table>
	<para>To get more information about the naming of devices and their major and minor number, visit http://www.lanana.org/docs/device-list/devices.txt .</para>
	</section>
	<section><title>Erasing a hard disk</title>
		<para>Before selling your old hard disk on the internet, it might be a good idea to really erase it. By simply repartitioning or even after a new mkfs command, some people will still be able to read most of the data on the disk. Although technically the <command>badblocks</command><indexterm><primary>badblocks(1)</primary></indexterm> tool is meant to look for bad blocks, you can use it to erase a disk. Since this is really writing to every sector of the disk, it can take a long time!</para>
		<screen>
root@RHELv4u2:~# badblocks -ws /dev/sdb
Testing with pattern 0xaa: done                        
Reading and comparing: done                        
Testing with pattern 0x55: done                        
Reading and comparing: done                        
Testing with pattern 0xff: done                        
Reading and comparing: done                        
Testing with pattern 0x00: done                        
Reading and comparing: done                        
		</screen>
	</section>
	<section><title>fdisk</title>
		<para>You can start by using <command>fdisk</command><indexterm><primary>fdisk(1)</primary></indexterm> to find out what kind of disks are seen by the kernel. Below the result on Debian, with two <command>ATA-IDE disks</command> present.</para>
		<screen>
root@barry:~# fdisk -l | grep Disk
Disk /dev/hda: 60.0 GB, 60022480896 bytes
Disk /dev/hdb: 81.9 GB, 81964302336 bytes
		</screen>
		<para>And here an example of <command>SATA disks</command> on a laptop with Ubuntu. SATA hard disks are presented to you with the SCSI /dev/sdx notation.</para>
		<screen>
root@laika:~# fdisk -l | grep Disk
Disk /dev/sda: 100.0 GB, 100030242816 bytes
Disk /dev/sdb: 100.0 GB, 100030242816 bytes
		</screen>
		<para>And last but not least, an overview of disks on a RHEL4u3 server with two real 72GB <command>SCSI disks</command>. This server is attached to a NAS with four <command>NAS disks</command> of half a terabyte. On the NAS disks, four LVM software RAID devices are configured.</para>
		<screen>
[root@tsvtl1 ~]# fdisk -l | grep Disk
Disk /dev/sda: 73.4 GB, 73407488000 bytes
Disk /dev/sdb: 73.4 GB, 73407488000 bytes
Disk /dev/sdc: 499.0 GB, 499036192768 bytes
Disk /dev/sdd: 499.0 GB, 499036192768 bytes
Disk /dev/sde: 499.0 GB, 499036192768 bytes
Disk /dev/sdf: 499.0 GB, 499036192768 bytes
Disk /dev/md0: 271 MB, 271319040 bytes
Disk /dev/md2: 21.4 GB, 21476081664 bytes
Disk /dev/md3: 21.4 GB, 21467889664 bytes
Disk /dev/md1: 21.4 GB, 21476081664 bytes
		</screen>
		<para>You can also use fdisk to obtain information about one specific hard disk device.</para>
		<screen>
[root@rhel4 ~]# fdisk -l /dev/sda

Disk /dev/sda: 12.8 GB, 12884901888 bytes
255 heads, 63 sectors/track, 1566 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1          13      104391   83  Linux
/dev/sda2              14        1566    12474472+  8e  Linux LVM
		</screen>
		<para>Later we will use fdisk to do dangerous stuff like creating and deleting partitions.</para>
	</section>
	<section><title>hdparm</title>
		<para>To obtain (or set) information and parameters about an ATA (or SATA) hard disk device, you can use <command>hdparm</command><indexterm><primary>hdparm(1)</primary></indexterm>. The -i and -I options will give you even more information about the physical properties of the device.</para>
		<screen>
root@laika:~# hdparm /dev/sdb

/dev/sdb:
 IO_support   =  0 (default 16-bit)
 readonly     =  0 (off)
 readahead    = 256 (on)
 geometry     = 12161/255/63, sectors = 195371568, start = 0
		</screen>
	</section>
	<section><title>dmesg</title>
		<para>Kernel boot messages can be seen after boot with <command>dmesg</command><indexterm><primary>dmesg(1)</primary></indexterm>. Since hard disk devices are detected by the kernel during boot, you can also use dmesg to find information.</para>
		<screen>
root@barry:~# dmesg | grep "[hs]d[a-z]"
Kernel command line: root=/dev/hda1 ro 
    ide0: BM-DMA at 0xfc00-0xfc07, BIOS settings: hda:DMA, hdb:DMA
    ide1: BM-DMA at 0xfc08-0xfc0f, BIOS settings: hdc:DMA, hdd:DMA
hda: ST360021A, ATA DISK drive
hdb: Maxtor 6Y080L0, ATA DISK drive
hdc: SONY DVD RW DRU-510A, ATAPI CD/DVD-ROM drive
hdd: SONY DVD RW DRU-810A, ATAPI CD/DVD-ROM drive
hda: max request size: 128KiB
hda: 117231408 sectors (60022 MB) w/2048KiB Cache, CHS=65535/16/63, UDMA
 hda: hda1 hda2
hdb: max request size: 128KiB
hdb: 160086528 sectors (81964 MB) w/2048KiB Cache, CHS=65535/16/63, UDMA
 hdb: hdb1 hdb2
hdc: ATAPI 32X DVD-ROM DVD-R CD-R/RW drive, 8192kB Cache, UDMA(33)
hdd: ATAPI 40X DVD-ROM DVD-R CD-R/RW drive, 2048kB Cache, UDMA(33)
...
		</screen>
	</section>
	<section><title>/proc/scsi/scsi</title>
		<para>You can also look at the contents of <command>/proc/scsi/scsi</command><indexterm><primary>/proc/scsi/scsi</primary></indexterm>.</para>
		<screen>
root@shaka:~# cat /proc/scsi/scsi 
Attached devices:
Host: scsi0 Channel: 00 Id: 00 Lun: 00
  Vendor: Adaptec  Model: RAID5            Rev: V1.0
  Type:   Direct-Access                    ANSI SCSI revision: 02
Host: scsi1 Channel: 00 Id: 00 Lun: 00
  Vendor: SEAGATE  Model: ST336605FSUN36G  Rev: 0438
  Type:   Direct-Access                    ANSI SCSI revision: 03
  root@shaka:~# 
		</screen>
	</section>
	<section><title>scsi_info</title>
		<para>You can also use <command>scsi_info</command><indexterm><primary>scsi_info(1)</primary></indexterm>.</para> 
		<screen>
root@shaka:~# scsi_info /dev/sdb
SCSI_ID="0,0,0"
HOST="1"
MODEL="SEAGATE ST336605FSUN36G"
FW_REV="0438"
root@shaka:~#
		</screen>
	</section>
	<section><title>lsscsi</title>
		<para>And even <command>lsscsi</command><indexterm><primary>lsscsi(1)</primary></indexterm> if it is installed.</para>
		<screen>
root@shaka:~# lsscsi 
[0:0:0:0]    disk    Adaptec  RAID5            V1.0  /dev/sda
[1:0:0:0]    disk    SEAGATE  ST336605FSUN36G  0438  /dev/sdb
root@shaka:~# 
		</screen>
	</section>
	<section><title>Practice hard disk devices</title>
		<para>1. Use dmesg to make a list of hard disk devices (ide,ata,sata,scsi) detected at bootup.</para>
		<para>2. Use fdisk to find the total size of all hard disk devices on your system.</para>
		<para>3. Stop a virtual machine, add a virtual 10 gigabyte SCSI hard disk and a virtual 100 megabyte SCSI hard disk.</para>
		<para>4. Use dmesg and fdisk (with grep) to display some information about the new disks.</para>
		<para>5. Use badblocks to completely erase the 100 mb hard disk.</para>
		<para>6. Look at /proc/scsi/scsi.</para>
	</section>
</section>
