	<section><title>smb.conf</title>
		<para>The <command>workgroup</command> option in the global section should match the netbios name of the Active Directory domain. Authentication will not be handled by Samba now, but by the Active Directory Domain Controllers, so we set the <command>security</command> option to domain. Since linux requires a user account for every user accessing its file system, we need to provide Samba with a range of uid's and gid's that it can use to create these user accounts. The first Active Directory user to connect will receive linux uid 20000. Below is our new global section in smb.conf.</para>
		<screen>
[global]
	workgroup = PEGASUS
	server string = Pegasus Domain Member Server
	security = Domain
	idmap uid = 20000-22000
	idmap gid = 20000-22000
	winbindd use default domain = Yes
		</screen>
		<para>Nothing special is required for the share section in smb.conf. Remember, we do not manually create users in smbpasswd or on the linux (/etc/passwd). Only Active Directory users are allowed access.</para>
		<screen>
[domaindata]
	path = /srv/samba/domaindata
	comment = Active Directory users only
	read only = No
		</screen>
	</section>
	<section><title>Joining the Active Directory Domain</title>
		<para>While the Samba server is stopped, you can use <command>net rpc join</command><indexterm><primary>net rpc join</primary></indexterm> to join the Active Directory Domain.</para>
		<screen>
[root@RHEL4b samba]# net rpc join -UAdministrator%Stargate1
Joined domain PEGASUS.
[root@RHEL4b samba]# 
		</screen>
		<para>Time to start Samba followed by <command>winbind</command><indexterm><primary>winbind</primary></indexterm>.</para>
		<screen>
[root@RHEL4b samba]# service smb start
Starting SMB services:                                     [  OK  ]
Starting NMB services:                                     [  OK  ]
[root@RHEL4b samba]# service winbindd start
Starting winbindd services:                                [  OK  ]
[root@RHEL4b samba]# 
		</screen>
	</section>
	<section><title>nsswitch.conf</title>
		<para>We need to update the <command>/etc/nsswitch.conf</command><indexterm><primary>/etc/nsswitch.conf</primary></indexterm> file now, so user group and host names can be resolved against the winbindd daemon.</para>
		<screen>
[root@RHEL4b samba]# vi /etc/nsswitch.conf 
[root@RHEL4b samba]# grep winbindd /etc/nsswitch.conf 
passwd:     files winbindd
group:      files winbindd
hosts:      files dns winbindd
[root@RHEL4b samba]#
		</screen>
	</section>
	<section><title>winbind</title>
		<para>The <command>winbind</command><indexterm><primary>winbind</primary></indexterm> daemon is talking with the Active Directory domain. With <command>wbinfo</command><indexterm><primary>wbinfo(1)</primary></indexterm> you can provide winbindd with credentials to talk to Active Directory.</para>
		<screen>[root@RHEL4b samba]# wbinfo --set-auth-user=Administrator%Stargate1</screen>
		<para>We can also use <command>wbinfo -a</command> to verify authentication of a user against Active Directory. Assuming a user account Venus with password VenusW is just created on the Active Directory, we get the following screenshot. </para>
		<screen>
[root@RHEL4b samba]# wbinfo -a Venus%VenusW
plaintext password authentication succeeded
challenge/response password authentication succeeded
[root@RHEL4b samba]# 
		</screen>
		<para>We can use <command>getent</command><indexterm><primary>getent(1)</primary></indexterm> to verify that winbindd is working and actually adding the Active directory users to /etc/passwd. The screenshot below shows that Kim and Serena are normal linux users in /etc/passwd, and that the Active Directory user Venus received uid 20000 in /etc/passwd.</para>
		<screen>
[root@RHEL4b samba]# getent passwd Kim
Kim:x:504:504:Kim Clijsters:/home/Kim:/bin/bash
[root@RHEL4b samba]# getent passwd Serena
Serena:x:503:503:Serena Williams:/home/Serena:/bin/bash
[root@RHEL4b samba]# getent passwd Venus
venus:*:20000:20000::/home/PEGASUS/venus:/bin/false
		</screen>
		<para>Not all Active Directory user accounts added to /etc/passwd by winbindd, only those that have been used.</para>
		<screen>
[root@RHEL4b samba]# getent passwd Justine
[root@RHEL4b samba]# wbinfo -a Justine%JustineH
plaintext password authentication succeeded
challenge/response password authentication succeeded
[root@RHEL4b samba]# getent passwd Justine
justine:*:20001:20000::/home/PEGASUS/justine:/bin/false
[root@RHEL4b samba]#
		</screen>
		<para>All the Active Directory users can now easily connect to the Samba share. Files created by them, belong to them. </para>
		<screen>
[root@RHEL4b samba]# ll /srv/samba/domaindata/
total 0
-rwxr--r--  1 justine 20000 0 Jun 22 19:54 created_by_justine_on_winxp.txt
-rwxr--r--  1 venus   20000 0 Jun 22 19:55 created_by_venus.txt
-rwxr--r--  1 maria   20000 0 Jun 22 19:57 Maria.txt
		</screen>
	</section>
